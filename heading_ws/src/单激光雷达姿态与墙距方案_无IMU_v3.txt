单三维激光雷达掘进机姿态与墙距实时估计方案（无IMU）

​		面向井下巷道环境，使用单台三维激光雷达（无IMU、无轮速、无UWB）从标准点云数据中实时估计设备航向角、俯仰角、横滚角，并输出掘进机中轴线上前后 2 m位置到左右墙面的四个垂直距离。方案以准确性、精度优先，算力一般可满足实时运行。

1 需求与边界条件
		系统仅接入一条标准激光雷达点云 Topic（sensor_msgs/PointCloud2），不接入 IMU或其他外部姿态/里程计输入。雷达安装在履带式掘进机几何中心附近，设备尺寸约为长 4.5 m、宽 1.2m、履带长度 1.4 m、履带间距 1.0 m。巷道墙面与雷达的距离未知且变化范围大，可近至约 0.5 m甚至更近，也可远至 10 m以上。

​		地面可能存在坡度与局部不平整，墙面材质可能变化导致点密度与反射强度变化。距离输出不考虑俯仰与横滚对距离量的二次影响，即距离按“水平投影/去俯仰横滚后的几何”定义计算，但俯仰与横滚仍需给出并稳定输出。

2 坐标系与配置约定

​		默认激光雷达坐标系 Z 轴向上。掘进机前进方向（中轴线方向）在配置文件中显式指定为激光雷达坐标系的某一轴及其符号，取值为 +X、-X、+Y、-Y 之一。本文中的“掘进机中轴线”即该 forward_axis方向对应的直线；当设备存在航向偏角时，中轴线上不同前后位置到墙面的距离会显著不同。左向轴由右手系定义为 left_axis = Z × forward_axis（以 Z 轴正向为上）。例如 forward_axis=+X 时left_axis=+Y；forward_axis=+Y 时left_axis=-X。该约定用于在点云中对左右墙面进行一致的“左右”判定，而不依赖于墙面先验距离。航向偏角情况下“中轴线+2 m位置到墙面的垂直距离”定义示意。左前与左后可见显著不同，距离以中轴线指定点到墙面平面的最短距离计算。

3 数据接口与工程约束

​		节点仅依赖点云与静态外参。点云可来自 Velodyne 等旋转式雷达或固态雷达，要求至少包含x、y、z（米）字段；intensity、ring、time等字段可选，用于可选的强度辅助与去畸变，但本方案默认不依赖这些字段以保证通用性。若 base_link与 lidar_frame 不同，应在配置中提供静态外参（或通过 TF 静态发布），算法内部统一在 base_link坐标系下输出姿态与距离。输出包括姿态与四个距离。姿态输出为 roll、pitch、yaw（ZYX 欧拉角约定，yaw 绕 Z 轴、pitch 绕 Y
轴、roll 绕 X 轴，均以 base_link为参考）。距离输出为左前、左后、右前、右后四个标量，分别对应中轴线上 s=+2.0 m 与 s=-2.0 m两个采样点到左右墙面的最短距离。采样距离 2.0 m、有效高度范围、滤波参数等均允许配置。

4 总体算法流程（严格实现顺序）

​		每帧点云进入后，首先做点级过滤与体素降采样，将计算量稳定在可控范围内。随后在近距离区域估计地面主平面并由其法向求得俯仰与横滚。接着使用该俯仰与横滚对点云进行“去倾斜”变换（仅用于墙面与航向估计），在水平化点云中提取左右墙面垂直平面，基于墙面方向计算航向角。最后在水平化坐标系下，将中轴线上 s=±2 m 的两点带入左右墙面平面方程，得到左前、左后、右前、右后四个距离并发布。若任何关键几何估计不满足质量门限，则保持上一帧有效结果并输出置信标志，避免瞬时抖动传播到控制系统。

5 俯仰与横滚估计（地面主平面）

​		为适应地面不平整，本方案不对整幅巷道地面做全局平面假设，而仅在雷达附近的局部 ROI内估计主承载平面。实现时在 base_frame 下截取半径 ground_roi_radius 的点，先按 z高度分位数（ground_z_percentile）取低处点集合以排除墙面与设备自身，再以 MLESAC/RANSAC拟合平面 n_gp + d_g = 0。为抑制坑洼引入的离群点，使用局部半径离群滤波或统计离群滤波，并在RANSAC 后对内点做一次加权最小二乘精修（权重可与点到平面的残差呈 Tukey/Huber 形式）。由地面法向 n_g 计算使其对齐 +Z 的旋转 R_level，按 ZYX 约定分解得到 roll 与 pitch。roll/pitch输出建议在时间域做一阶低通或小窗中值滤波，滤波时间常数 temporal_smoothing_tau 典型取 0.2-0.5s，以兼顾响应与稳定性。

6 航向估计（左右墙面垂直平面）

​		航向角 yaw 通过墙面方向约束获得。首先对点云施加 R_level 将其水平化，随后仅保留高度位于[wall_z_min, wall_z_max] 的点以消除地面与顶板影响，再进行一次体素降采样。然后在该点集上进行多模型垂直平面提取：以“法向近似水平（|n_z| 小）”作为先验约束运行RANSAC，连续提取至多两组大平面内点，并要求内点数量不低于wall_inlier_min。
左右墙面判定不依赖先验距离，而使用平面到原点最近点向量 p0=-dn 的左右投影：若 p0left_axis>0则该墙为左墙，<0 则为右墙。该判定对平面方程符号翻转不敏感。为保证航向稳定性，当同时检测到两侧墙面时，要求两墙法向近似相反（|n_Ln_R|>wall_parallel_cos），否则认为墙面提取质量不足。航向方向向量可由单侧墙面法向得到 t = normalize(Z × n_wall)。当两侧墙均可用时，取 t为两侧结果的归一化加权平均（权重与内点数或拟合残差成反比）。yaw 定义为 base_frame 下 forward_axis绕 +Z 旋转到 t 的有符号角度，其符号由右手系确定，并通过选择 dot(t, forward_axis)>0 的方向消除前后180° 二义性。
​		墙面材质变化会导致点密度与反射强度不同，本方案以几何平面约束为主，对强度不做硬阈值过滤，避免“黑煤面/湿墙面”导致无点的问题。可选地，可引入强度变化率作为权重提高金属标识、管线等稳定结构对拟合的贡献，但必须仅作为加权项而非必要条件。

7 四个墙距定义与计算

​		距离计算在水平化坐标系中进行，等价于“忽略俯仰横滚对距离定义的影响”。中轴线采样点在base_frame 中定义为 P_front = s_frontforward_axis，P_back = s_backforward_axis。将其水平化得到P_front^L = R_levelP_front，P_back^L = R_levelP_back。对左右墙面分别具有平面方程 n_Lp + d_L =0、n_Rp + d_R = 0（在水平化坐标系下）。四个距离按点到平面最短距离计算：左前距离 d_LF = |n_LP_front^L + d_L|，左后距离 d_LB = |n_LP_back^L + d_L|；右前距离 d_RF =
|n_RP_front^L + d_R|，右后距离 d_RB = |n_RP_back^L +d_R|。若仅检测到单侧墙面，则仅发布该侧的前后距离并将另一侧标记为无效。由于掘进机长 4.5 m 且雷达位于中心，s=±2 m 采样点仍位于设备投影范围内，更贴合“车体前后端附近”的实际避障需求。若后续希望与履带外廓、机身外廓关联，可在配置中加入 lateral_offset（如 ±0.6m）将采样点从中轴线平移到履带外侧，但该属于扩展功能，不影响本方案的核心定义。

8 质量控制、退化检测与实时性

​		无 IMU情况下系统对几何退化更敏感，必须实现质量门限与退化处理。地面平面与墙面平面均需输出拟合残差
RMS、内点数、RANSAC 成功标志。若 ground_inlier_min 或 wall_inlier_min不满足，或墙面平面不满足垂直先验与两墙平行先验，则该帧yaw/距离不更新，仅输出上一帧结果并降低置信度。为了避免长直光滑巷道导致的偶发抖动，建议对 yaw做时间域平滑，并限制单帧变化率（例如 |Δyaw|<3°/frame 的软门限）。实时性实现建议采用单节点多线程结构：主线程接收点云并做轻量过滤与队列化，工作线程完成平面拟合与输出。体素滤波 5 cm、RANSAC 迭代次数上限 200-400、点数控制在 2-5 万以内时，在常见 ARM64工控平台上可达 10-20 Hz。若点数更大，优先通过自适应下采样与 ROI 限制而非降低 RANSAC阈值，以免准确性退化。

9 输出话题建议

​		推荐发布两个 Topic：/pose_wall/attitude（geometry_msgs/Vector3Stamped，x=roll,y=pitch,z=yaw，单位rad）与 /pose_wall/distances（自定义消息或 std_msgs/Float32MultiArray，按顺序[d_LF,d_LB,d_RF,d_RB]，单位 m），并在同一 Header时间戳下发布。为工程可维护性，节点启动时从配置文件加载 pointcloud_topic、base_frame、forward_axis等所有关键约束，并在日志中打印最终解析后的轴向与采样点，确保调试时“中轴线”定义无歧义。

附注：本方案输出的是相对于当前局部地面/墙面几何的姿态与墙距，不提供全局位置或地图。若未来需要全局定位与建图，应引入里程计/IMU/回环等约束建立完整SLAM，但这超出当前单雷达无外部输入的边界。