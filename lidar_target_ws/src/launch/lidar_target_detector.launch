<?xml version="1.0"?>
<!--
    激光雷达反光标靶检测系统启动文件
    功能：启动激光雷达反光标靶检测节点和可视化工具
-->
<launch>
    <!--
        激光雷达反光标靶检测节点
        pkg: 包名，指定包含检测节点的ROS包
        type: 可执行文件名称，对应编译后的二进制文件
        name: 节点名称，用于ROS系统中的标识
        output: 输出方式，screen表示在终端显示日志信息
    -->
    <node pkg="lidar_target_detection" type="lidar_target_detector" name="lidar_target_detector" output="screen">
        <!--
            输入点云话题重映射
            from: 节点内部订阅的话题名称
            to: 实际激光雷达发布的话题名称，需要根据具体设备修改
            说明：将节点内部的input_cloud话题重映射到实际的激光雷达话题
        -->
        <remap from="input_cloud" to="/timoo_points" />

        <!--
            算法参数配置区域
            以下参数用于调整检测算法的性能和精度
        -->

        <!-- 强度阈值：过滤掉反射强度低于此值的点云数据，单位：无单位（相对强度值） -->
        <param name="intensity_threshold" type="double" value="150.0" />

        <!-- 聚类容差：欧几里得聚类算法中判断点是否属于同一簇的距离阈值，单位：米 -->
        <param name="cluster_tolerance" type="double" value="0.5" />

        <!-- 最小聚类大小：有效聚类必须包含的最小点数，避免处理噪声点 -->
        <param name="min_cluster_size" type="int" value="10" />

        <!-- 最大聚类大小：有效聚类允许包含的最大点数，避免处理过大区域 -->
        <param name="max_cluster_size" type="int" value="500" />

        <!-- 最小圆弧角度：有效圆弧必须覆盖的最小角度范围，单位：度 -->
        <param name="min_arc_angle" type="double" value="30.0" />

        <!-- 最大圆弧角度：有效圆弧允许覆盖的最大角度范围，单位：度 -->
        <param name="max_arc_angle" type="double" value="180.0" />

        <!-- 最大RMSE阈值：圆弧拟合的最大允许均方根误差，用于质量检验，单位：米 -->
        <param name="max_rmse_threshold" type="double" value="0.05" />

        <!-- 最小目标半径：有效标靶的最小半径约束，单位：米 -->
        <param name="min_target_radius" type="double" value="0.05" />

        <!-- 最大目标半径：有效标靶的最大半径约束，单位：米 -->
        <param name="max_target_radius" type="double" value="0.5" />

        <!-- TCP端口：Modbus TCP服务器监听端口，避免与其他服务冲突 -->
        <param name="tcp_port" type="int" value="5050" />
    </node>

    <!--
        RViz可视化节点（可选）
        功能：启动RViz可视化工具，用于实时查看检测结果
        args: 指定RViz配置文件路径，自动加载预设的可视化配置
        注意：如果不需要可视化，可以注释掉此节点
    -->
    <!-- <node pkg="rviz" type="rviz" name="rviz" args="-d $(find lidar_target_detection)/config/target_detection.rviz" /> -->
</launch>
